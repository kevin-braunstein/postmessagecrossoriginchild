<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Child iFrame (Sender)</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #e8f4fd; }
        .log-box { background: #fff; border: 1px solid #999; padding: 10px; }
        .code-block { background: #333; color: #fff; padding: 5px; border-radius: 3px; display: block; white-space: pre; margin: 5px 0; }
        .msg { margin: 5px 0; border-bottom: 1px solid #eee; }
        .highlight { color: #d9534f; font-weight: bold; }
    </style>
</head>
<body>

    <h3>Child iFrame</h3>
    <p>Origin: <script>document.write(window.origin)</script></p>
    <div class="log-box" id="childLog"><strong>Child Log:</strong><br></div>

    <script>
        const logger = document.getElementById('childLog');
        function log(text) {
            const div = document.createElement('div');
            div.className = "msg";
            div.innerHTML = `[Child] ${text}`;
            logger.appendChild(div);
        }

        function displayFunctionSignature(obj, label) {
            try {
                const signature = obj.toString();
                logger.innerHTML += `<span class='highlight'>${label} signature detected as:</span> <span class='code-block'>${signature}</span>`;
            } catch(e) {
                log(`Could not read signature: ${e.message}`);
            }
        }

        // --- 1. OVERRIDE postMessage on CHILD (Self) ---
        // This proves __defineGetter__ works generally
        window.__defineGetter__("postMessage", function() {
            return function() {
                log("INTERCEPTED: Internal call to child's postMessage caught.");
            }
        });

        // --- 2. INSPECT PARENT (The Verification) ---
        // The Parent has overridden its postMessage. Can we see it?
        setTimeout(() => {
            log("--- BEGIN INSPECTION ---");
            
            // This is the critical output you requested
            displayFunctionSignature(window.parent.postMessage, "window.parent.postMessage");

            if (window.parent.postMessage.toString().indexOf("native code") !== -1) {
                log("RESULT: Secure. We see [native code], not the Parent's override.");
            } else {
                log("RESULT: INSECURE. We see the Parent's custom function.");
            }

            // --- 3. ATTEMPT SENDING ---
            log("--- ATTEMPTING POSTMESSAGE ---");
            // If the override worked cross-origin, this would trigger the Parent's "INTERCEPTED" log.
            // If the override is bypassed (secure), the Parent will log "Received message".
            window.parent.postMessage("Hello from Child Frame!", "*");
            
            log("Message sent to parent.");
        }, 1000);

    </script>
</body>
</html>
